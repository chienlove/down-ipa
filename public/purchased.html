<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Th√™m ·ª©ng d·ª•ng v√†o "ƒê√£ mua" ‚Äì iOS Purchase Helper</title>

<style>
    :root {
        --primary: #6366f1;
        --primary-hover: #4f46e5;
        --secondary: #ec4899;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --bg-gradient-start: #fdf4ff;
        --bg-gradient-end: #e0e7ff;
        --card-bg: #ffffff;
        --text-dark: #1e293b;
        --text-muted: #64748b;
        --border: #e2e8f0;
        --input-bg: #f8fafc;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        min-height: 100vh;
        padding: 24px 16px 40px;
        background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        color: var(--text-dark);
        line-height: 1.6;
    }

    .container {
        max-width: 680px;
        margin: 0 auto;
    }

    /* Header */
    .header {
        text-align: center;
        margin-bottom: 32px;
    }

    .header-title {
        font-size: 32px;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .header-icon {
        font-size: 36px;
    }

    .header-subtitle {
        font-size: 15px;
        color: var(--text-muted);
        font-weight: 500;
    }

    /* Card */
    .card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.8);
    }

    /* Info Box */
    .info-box {
        background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        border-radius: 16px;
        padding: 20px;
        border-left: 4px solid var(--primary);
    }

    .info-title {
        font-size: 16px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .info-text {
        font-size: 14px;
        color: var(--text-dark);
        margin-bottom: 12px;
    }

    .info-example {
        background: rgba(255, 255, 255, 0.7);
        padding: 14px;
        border-radius: 12px;
        font-size: 13px;
        color: var(--text-dark);
        line-height: 1.7;
    }

    .info-example strong {
        color: var(--primary);
    }

    /* Form */
    .form-header {
        margin-bottom: 20px;
    }

    .form-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-subtitle {
        font-size: 13px;
        color: var(--text-muted);
    }

    .form-group {
        margin-bottom: 18px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
    }

    .required {
        color: var(--danger);
    }

    .form-input {
        width: 100%;
        padding: 14px 16px;
        font-size: 16px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--input-bg);
        transition: all 0.2s ease;
        outline: none;
    }

    .form-input:focus {
        border-color: var(--primary);
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    .form-hint {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 6px;
        line-height: 1.5;
    }

    .form-hint code {
        background: rgba(99, 102, 241, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 11px;
        color: var(--primary);
    }

    /* Button */
    .btn-submit {
        width: 100%;
        padding: 16px;
        font-size: 16px;
        font-weight: 700;
        color: #ffffff;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        margin-top: 8px;
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }

    .btn-submit:active {
        transform: translateY(0);
    }

    /* Loading */
    .loading {
        display: none;
        text-align: center;
        margin-top: 16px;
    }

    .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 10px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loading-text {
        font-size: 14px;
        color: var(--text-muted);
        font-weight: 500;
    }

    /* Alert */
    .alert {
        padding: 14px 16px;
        border-radius: 12px;
        margin-top: 16px;
        font-size: 14px;
        font-weight: 500;
        display: none;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border-left: 4px solid var(--danger);
    }

    /* 2FA Alert (m·ªõi) */
    .alert-info {
        background: #eef2ff;
        color: #3730a3;
        border-left: 4px solid #6366f1;
    }

    /* Result */
    .result {
        display: none;
        margin-top: 16px;
        padding: 20px;
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        border-radius: 16px;
        border-left: 4px solid var(--success);
        animation: slideIn 0.3s ease;
    }

    .result-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
        font-size: 15px;
        font-weight: 700;
        color: #065f46;
    }

    .app-display {
        display: flex;
        gap: 16px;
        align-items: center;
        background: rgba(255, 255, 255, 0.7);
        padding: 16px;
        border-radius: 12px;
    }

    .app-icon {
        width: 72px;
        height: 72px;
        border-radius: 16px;
        object-fit: cover;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.8);
    }

    .app-details {
        flex: 1;
    }

    .app-name {
        font-size: 17px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 8px;
    }

    .app-meta {
        font-size: 13px;
        color: var(--text-muted);
        line-height: 1.6;
    }

    .app-meta strong {
        color: var(--text-dark);
    }

    /* Tips */
    .tips-box {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border-radius: 16px;
        padding: 20px;
        border-left: 4px solid var(--warning);
    }

    .tips-title {
        font-size: 16px;
        font-weight: 700;
        color: #92400e;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .tips-list {
        list-style: none;
        font-size: 13px;
        color: var(--text-dark);
    }

    .tips-list li {
        margin-bottom: 10px;
        padding-left: 24px;
        position: relative;
        line-height: 1.6;
    }

    .tips-list li::before {
        content: "‚Üí";
        position: absolute;
        left: 0;
        color: var(--warning);
        font-weight: 700;
    }

    /* Responsive */
    @media (max-width: 480px) {
        .header-title {
            font-size: 26px;
        }

        .card {
            padding: 20px 16px;
        }

        .app-display {
            flex-direction: column;
            text-align: center;
        }

        .app-icon {
            width: 80px;
            height: 80px;
        }
    }
</style>
</head>

<body>
<div class="container">
    <!-- Header -->
    <header class="header">
        <h1 class="header-title">
            <span class="header-icon">üì±</span>
            iOS Purchase Helper
        </h1>
        <p class="header-subtitle">Th√™m app mi·ªÖn ph√≠ v√†o "ƒê√£ mua" ƒë·ªÉ t·∫£i tr√™n thi·∫øt b·ªã iOS c≈©</p>
    </header>

    <!-- Quick Info -->
    <div class="card">
        <div class="info-box">
            <div class="info-title">
                üí° C√¥ng c·ª• n√†y l√†m g√¨?
            </div>
            <div class="info-text">
                Gi√∫p b·∫°n th√™m app mi·ªÖn ph√≠ v√†o danh s√°ch "ƒê√£ mua" c·ªßa Apple ID. Sau ƒë√≥, b·∫°n c√≥ th·ªÉ t·∫£i phi√™n b·∫£n t∆∞∆°ng th√≠ch v·ªõi iOS c≈© h∆°n (n·∫øu nh√† ph√°t tri·ªÉn v·∫´n h·ªó tr·ª£).
            </div>
            <div class="info-example">
                <strong>V√≠ d·ª•:</strong> iPhone c≈© ch·∫°y iOS 10 kh√¥ng c√†i ƒë∆∞·ª£c Facebook phi√™n b·∫£n m·ªõi. D√πng c√¥ng c·ª• n√†y ƒë·ªÉ th√™m v√†o "ƒê√£ mua", sau ƒë√≥ m·ªü App Store ‚Üí tab ƒê√£ mua ‚Üí t·∫£i phi√™n b·∫£n c≈© ph√π h·ª£p.
            </div>
        </div>
    </div>

    <!-- Form -->
    <div class="card">
        <div class="form-header">
            <div class="form-title">
                üîê Nh·∫≠p th√¥ng tin
            </div>
            <div class="form-subtitle">
                Th√¥ng tin ch·ªâ d√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p v√† kh√¥ng ƒë∆∞·ª£c l∆∞u tr·ªØ
            </div>
        </div>

        <form id="purchaseForm">
            <div class="form-group">
                <label class="form-label">
                    Apple ID <span class="required">*</span>
                </label>
                <input 
                    type="email" 
                    id="APPLE_ID" 
                    class="form-input"
                    autocomplete="username" 
                    placeholder="your.email@example.com" 
                    required
                />
            </div>

            <div class="form-group">
                <label class="form-label">
                    M·∫≠t kh·∫©u <span class="required">*</span>
                </label>
                <input 
                    type="password" 
                    id="PASSWORD" 
                    class="form-input"
                    autocomplete="current-password" 
                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u Apple ID" 
                    required
                />
            </div>

            <div class="form-group">
                <label class="form-label">
                    M√£ 2FA (n·∫øu c√≥)
                </label>
                <input 
                    id="CODE" 
                    class="form-input"
                    inputmode="numeric" 
                    pattern="[0-9]*" 
                    placeholder="M√£ x√°c th·ª±c 6 s·ªë"
                />
            </div>

            <div class="form-group">
                <label class="form-label">
                    ·ª®ng d·ª•ng c·∫ßn th√™m <span class="required">*</span>
                </label>
                <input 
                    id="INPUT" 
                    class="form-input"
                    placeholder="URL, App ID ho·∫∑c Bundle ID" 
                    required
                />
                <div class="form-hint">
                    URL: <code>https://apps.apple.com/.../id284882215</code><br>
                    App ID: <code>284882215</code><br>
                    Bundle ID: <code>com.facebook.Facebook</code>
                </div>
            </div>

            <button type="submit" class="btn-submit">
                ‚ú® Th√™m v√†o "ƒê√£ mua"
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div class="loading-text">ƒêang x·ª≠ l√Ω...</div>
            </div>
        </form>

        <!-- H·ªôp th√¥ng b√°o 2FA -->
        <div id="twofaBox" class="alert alert-info"></div>

        <!-- H·ªôp l·ªói -->
        <div id="errorBox" class="alert alert-error"></div>
        
        <!-- K·∫øt qu·∫£ -->
        <div id="resultCard" class="result">
            <div class="result-header" id="resultHeader">
                ‚úÖ Th√†nh c√¥ng!
            </div>
            <div class="app-display" id="appInfo"></div>
        </div>
    </div>

    <!-- Tips -->
    <div class="card">
        <div class="tips-box">
            <div class="tips-title">
                ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng
            </div>
            <ul class="tips-list">
                <li>Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ƒë∆∞·ª£c l∆∞u tr·ªØ tr√™n h·ªá th·ªëng</li>
                <li>Ch·ªâ h·ªó tr·ª£ app mi·ªÖn ph√≠, kh√¥ng d√πng cho app tr·∫£ ph√≠</li>
                <li>K·∫øt qu·∫£ ph·ª• thu·ªôc v√†o ch√≠nh s√°ch c·ªßa Apple v√† nh√† ph√°t tri·ªÉn</li>
                <li>Sau khi th√™m, m·ªü App Store ‚Üí ƒê√£ mua ƒë·ªÉ t·∫£i app</li>
            </ul>
        </div>
    </div>
</div>

<script>
    const $ = (sel) => document.querySelector(sel);

    const form = $("#purchaseForm");
    const loadingEl = $("#loading");
    const errorBox = $("#errorBox");
    const twofaBox = $("#twofaBox");
    const resultCard = $("#resultCard");
    const appInfo = $("#appInfo");
    const resultHeader = $("#resultHeader");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Reset tr·∫°ng th√°i UI
        errorBox.style.display = "none";
        errorBox.textContent = "";
        twofaBox.style.display = "none";
        twofaBox.textContent = "";
        resultCard.style.display = "none";
        appInfo.innerHTML = "";
        resultHeader.textContent = "‚úÖ Th√†nh c√¥ng!";

        loadingEl.style.display = "block";

        const body = {
            APPLE_ID: $("#APPLE_ID").value.trim(),
            PASSWORD: $("#PASSWORD").value.trim(),
            CODE: $("#CODE").value.trim(),
            input: $("#INPUT").value.trim()
        };

        try {
            const res = await fetch("/purchase", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            const data = await res.json();
            loadingEl.style.display = "none";

            if (!data) {
                errorBox.textContent = "‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi t·ª´ m√°y ch·ªß.";
                errorBox.style.display = "block";
                return;
            }

            // Tr∆∞·ªùng h·ª£p y√™u c·∫ßu 2FA
            if (data.require2FA) {
                twofaBox.textContent = data.error || "T√†i kho·∫£n n√†y y√™u c·∫ßu m√£ x√°c minh 2 b∆∞·ªõc. H√£y nh·∫≠p m√£ 6 s·ªë v√†o √¥ M√£ 2FA r·ªìi b·∫•m l·∫°i.";
                twofaBox.style.display = "block";
                const codeInput = $("#CODE");
                if (codeInput) codeInput.focus();
                return;
            }

            // Tr∆∞·ªùng h·ª£p l·ªói chung
            if (!data.success) {
                errorBox.textContent = (data && data.error) || "‚ùå Kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu. Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin.";
                errorBox.style.display = "block";
                return;
            }

            // Th√†nh c√¥ng (c√≥ th·ªÉ l√† ƒë√£ n·∫±m trong ƒê√£ mua)
            const app = data.app || {};
            const icon = app.icon || "https://via.placeholder.com/120?text=App";

            if (data.alreadyInPurchased) {
                // App ƒë√£ n·∫±m trong ƒê√£ mua
                resultHeader.textContent = "‚ÑπÔ∏è ·ª®ng d·ª•ng n√†y ƒë√£ n·∫±m trong \"ƒê√£ mua\" c·ªßa Apple ID n√†y.";
            } else {
                // Th√™m m·ªõi th√†nh c√¥ng
                resultHeader.textContent = "‚úÖ Th√™m ·ª©ng d·ª•ng v√†o \"ƒê√£ mua\" th√†nh c√¥ng.";
            }

            appInfo.innerHTML = `
                <img src="${icon}" alt="App Icon" class="app-icon">
                <div class="app-details">
                    <div class="app-name">${app.name || "Kh√¥ng r√µ t√™n"}</div>
                    <div class="app-meta">
                        Bundle: <strong>${app.bundleId || "N/A"}</strong><br>
                        Phi√™n b·∫£n: <strong>${app.version || "N/A"}</strong><br>
                        Nh√† ph√°t h√†nh: <strong>${app.artistName || "N/A"}</strong>
                    </div>
                </div>
            `;

            resultCard.style.display = "block";
        } catch (err) {
            loadingEl.style.display = "none";
            errorBox.textContent = "‚ùå " + (err.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh");
            errorBox.style.display = "block";
        }
    });
</script>

</body>
</html>