<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Th√™m ·ª©ng d·ª•ng v√†o ‚Äúƒê√£ mua‚Äù ‚Äì iOS Purchase Helper</title>

<style>
    :root {
        --bg-top: #e0f2fe;
        --bg-bottom: #fef9c3;
        --card-bg: #ffffff;
        --border: #e2e8f0;
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --success: #16a34a;
        --danger: #dc2626;
        --warning: #f97316;
        --text: #0f172a;
        --muted: #6b7280;
        --info: #4f46e5;
    }

    * {
        box-sizing: border-box;
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 20px 16px 32px;
        background: linear-gradient(135deg, var(--bg-top), var(--bg-bottom));
        font-family: system-ui, -apple-system, Segoe UI, Roboto;
        color: var(--text);
        display: flex;
        justify-content: center;
    }

    .page {
        width: 100%;
        max-width: 720px;
    }

    .page-header {
        text-align: center;
        margin-bottom: 16px;
    }

    .page-title {
        font-size: 26px;
        font-weight: 800;
        margin: 0;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: #0f172a;
    }

    .badge {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        padding: 3px 7px;
        border-radius: 999px;
        background: rgba(37,99,235,0.08);
        color: var(--primary-dark);
        font-weight: 700;
    }

    .page-sub {
        margin-top: 6px;
        font-size: 14px;
        color: var(--muted);
    }

    .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 18px 18px 20px;
        box-shadow: 0 6px 16px rgba(15,23,42,0.08);
        margin-bottom: 16px;
    }

    .intro-card {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .intro-title {
        font-weight: 700;
        font-size: 16px;
        color: var(--info);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .intro-text {
        font-size: 14px;
        line-height: 1.6;
        color: var(--text);
    }

    .intro-example {
        margin-top: 8px;
        padding: 10px 12px;
        border-radius: 10px;
        background: #eef2ff;
        font-size: 13px;
        color: #312e81;
        border-left: 3px solid #4f46e5;
    }

    .intro-example strong {
        font-weight: 700;
    }

    .form-card-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #0f172a;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .form-card-title span.icon {
        font-size: 18px;
    }

    .form-card-sub {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 12px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 14px;
    }

    label {
        font-weight: 600;
        margin-bottom: 6px;
        font-size: 14px;
        color: #0f172a;
    }

    label span.required {
        color: var(--danger);
        margin-left: 3px;
    }

    input {
        padding: 12px 12px;
        font-size: 16px; /* FIX ZOOM iOS */
        border-radius: 9px;
        border: 1px solid var(--border);
        outline: none;
        transition: border-color .18s, box-shadow .18s, background-color .18s;
        background: #f9fafb;
    }

    input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 1px rgba(37,99,235,0.3);
        background: #ffffff;
    }

    .hint-list {
        margin-top: 4px;
        padding-left: 16px;
        font-size: 12px;
        color: var(--muted);
    }

    .hint-list li {
        margin-bottom: 3px;
    }

    button {
        background: var(--primary);
        color: white;
        width: 100%;
        border: none;
        padding: 13px;
        font-size: 16px;
        font-weight: 700;
        border-radius: 999px;
        cursor: pointer;
        transition: background .2s, transform .05s, box-shadow .1s;
        margin-top: 8px;
        box-shadow: 0 4px 10px rgba(37,99,235,0.3);
    }

    button:hover {
        background: var(--primary-dark);
    }

    button:active {
        transform: translateY(1px);
        box-shadow: 0 2px 6px rgba(37,99,235,0.25);
    }

    .loading-spinner {
        display: none;
        margin-top: 10px;
        text-align: center;
        font-size: 13px;
        color: var(--primary);
    }

    .spinner {
        width: 26px;
        height: 26px;
        border: 3px solid #d1d5db;
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.9s linear infinite;
        margin: 0 auto 6px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .error-box {
        border: 1px solid var(--danger);
        background: #fef2f2;
        padding: 12px;
        border-radius: 10px;
        margin-top: 10px;
        color: var(--danger);
        font-weight: 600;
        display: none;
        font-size: 13px;
    }

    .error-box::before {
        content: "‚ö†Ô∏è ";
        margin-right: 3px;
    }

    .result-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px 16px 18px;
        margin-top: 12px;
        display: none;
        animation: fadeIn .25s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .success-msg {
        color: var(--success);
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .success-msg span.icon {
        font-size: 18px;
    }

    .app-info {
        display: flex;
        gap: 14px;
        align-items: center;
        margin-top: 4px;
    }

    .app-info img {
        width: 68px;
        height: 68px;
        border-radius: 16px;
        border: 1px solid var(--border);
        object-fit: cover;
        background: #f9fafb;
    }

    .app-meta-main {
        font-size: 14px;
    }

    .app-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .app-meta-main div {
        margin-bottom: 2px;
    }

    .info-card {
        font-size: 13px;
        color: var(--text);
    }

    .info-card h2 {
        margin: 0 0 6px;
        font-size: 15px;
        font-weight: 700;
        color: var(--info);
    }

    .info-card p {
        margin: 4px 0;
        line-height: 1.5;
    }

    .info-card .example {
        margin-top: 8px;
        padding: 8px 10px;
        border-radius: 10px;
        background: #ecfdf5;
        border-left: 3px solid var(--success);
        font-size: 13px;
        color: #065f46;
    }

    .note-card {
        border-left: 4px solid var(--warning);
    }

    .note-title {
        font-size: 15px;
        font-weight: 800;
        color: var(--warning);
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .note-title span.icon {
        font-size: 18px;
    }

    .note-list {
        margin: 2px 0 0;
        padding-left: 18px;
        font-size: 13px;
        color: var(--text);
    }

    .note-list li {
        margin: 4px 0;
    }

    .note-list span.num {
        font-weight: 700;
        color: var(--warning);
        margin-right: 4px;
    }

    @media (max-width: 480px) {
        .card {
            padding: 16px 14px 17px;
        }
        .page-title {
            font-size: 23px;
        }
    }
</style>
</head>

<body>
<div class="page">
    <header class="page-header">
        <h1 class="page-title">
            Th√™m v√†o ‚Äúƒê√£ mua‚Äù
            <span class="badge">Helper</span>
        </h1>
        <div class="page-sub">
            ƒê∆∞a app mi·ªÖn ph√≠ v√†o m·ª•c Purchased ƒë·ªÉ t·∫£i l·∫°i tr√™n thi·∫øt b·ªã iOS c≈©.
        </div>
    </header>

    <!-- Card gi·ªõi thi·ªáu ng·∫Øn g·ªçn (tr√™n form) -->
    <section class="card intro-card">
        <div class="intro-title">
            <span>üìå</span> Gi·ªõi thi·ªáu nhanh
        </div>
        <div class="intro-text">
            C√¥ng c·ª• n√†y gi√∫p b·∫°n th√™m <strong>·ª©ng d·ª•ng mi·ªÖn ph√≠</strong> v√†o m·ª•c <strong>‚Äúƒê√£ mua‚Äù (Purchased)</strong> c·ªßa Apple ID, 
            t·ª´ ƒë√≥ App Store th∆∞·ªùng cho ph√©p t·∫£i l·∫°i <strong>phi√™n b·∫£n t∆∞∆°ng th√≠ch nh·∫•t</strong> v·ªõi iOS ƒëang d√πng (n·∫øu nh√† ph√°t tri·ªÉn v·∫´n gi·ªØ b·∫£n c≈©).
        </div>
        <div class="intro-example">
            <strong>V√≠ d·ª•:</strong> B·∫°n c√≥ iPhone c≈© ch·∫°y iOS th·∫•p, Apple ID m·ªõi ch∆∞a t·ª´ng t·∫£i Facebook, Zalo, Messenger‚Ä¶  
            Khi t√¨m tr√™n App Store, m√°y b√°o <em>‚ÄúY√™u c·∫ßu iOS cao h∆°n‚Äù</em> v√† kh√¥ng cho c√†i.  
            B·∫°n d√πng c√¥ng c·ª• n√†y ƒë·ªÉ ƒë∆∞a app v√†o ‚Äúƒê√£ mua‚Äù, sau ƒë√≥:
            <br>‚Ä¢ M·ªü App Store ‚Üí tab <strong>ƒê√£ mua</strong>  
            <br>‚Ä¢ T√¨m app v·ª´a th√™m  
            <br>‚Üí N·∫øu Apple/nh√† ph√°t tri·ªÉn c√≤n gi·ªØ b·∫£n c≈©, b·∫°n c√≥ th·ªÉ t·∫£i phi√™n b·∫£n ph√π h·ª£p v·ªõi iOS hi·ªán t·∫°i.
        </div>
    </section>

    <!-- Card form -->
    <section class="card">
        <div class="form-card-title">
            <span class="icon">üß©</span>
            Nh·∫≠p th√¥ng tin Apple ID & ·ª©ng d·ª•ng
        </div>
        <div class="form-card-sub">
            H·ªá th·ªëng s·∫Ω d√πng ipatool ƒë·ªÉ ƒëƒÉng nh·∫≠p Apple ID (kh√¥ng l∆∞u t√†i kho·∫£n) v√† g·ª≠i y√™u c·∫ßu th√™m app v√†o m·ª•c ‚Äúƒê√£ mua‚Äù.
        </div>

        <form id="purchaseForm">
            <div class="form-group">
                <label>Apple ID <span class="required">*</span></label>
                <input type="email" id="APPLE_ID" autocomplete="username" placeholder="example@gmail.com" required>
            </div>

            <div class="form-group">
                <label>M·∫≠t kh·∫©u <span class="required">*</span></label>
                <input type="password" id="PASSWORD" autocomplete="current-password" placeholder="M·∫≠t kh·∫©u Apple ID" required>
            </div>

            <div class="form-group">
                <label>M√£ 2FA (n·∫øu c√≥)</label>
                <input id="CODE" inputmode="numeric" pattern="[0-9]*" placeholder="Nh·∫≠p m√£ 6 s·ªë n·∫øu Apple y√™u c·∫ßu">
            </div>

            <div class="form-group">
                <label>·ª®ng d·ª•ng c·∫ßn th√™m <span class="required">*</span></label>
                <input id="INPUT" placeholder="URL App Store, App ID (s·ªë), ho·∫∑c Bundle ID (com.xxx.yyy)" required>
                <ul class="hint-list">
                    <li>V√≠ d·ª• URL: <code>https://apps.apple.com/vn/app/facebook/id284882215</code></li>
                    <li>V√≠ d·ª• App ID: <code>284882215</code></li>
                    <li>V√≠ d·ª• Bundle ID: <code>com.facebook.Facebook</code></li>
                </ul>
            </div>

            <button type="submit">Th√™m ·ª©ng d·ª•ng v√†o ‚Äúƒê√£ mua‚Äù</button>

            <div class="loading-spinner" id="loading">
                <div class="spinner"></div>
                ƒêang x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n...
            </div>
        </form>

        <div id="errorBox" class="error-box"></div>
        <div id="resultCard" class="result-card">
            <div class="success-msg">
                <span class="icon">‚úÖ</span>
                ƒê√£ th√™m app v√†o ‚Äúƒê√£ mua‚Äù th√†nh c√¥ng (n·∫øu kh√¥ng c√≥ c·∫£nh b√°o t·ª´ Apple).
            </div>
            <div class="app-info" id="appInfo"></div>
        </div>
    </section>

    <!-- Card gi·∫£i th√≠ch chi ti·∫øt -->
    <section class="card info-card">
        <h2>·ª®ng d·ª•ng th·ª±c t·∫ø c·ªßa c√¥ng c·ª•</h2>
        <p>
            Sau khi m·ªôt app ƒë∆∞·ª£c ƒë∆∞a v√†o ‚Äúƒê√£ mua‚Äù, b·∫°n c√≥ th·ªÉ m·ªü App Store tr√™n c√°c thi·∫øt b·ªã kh√°c d√πng chung Apple ID:
        </p>
        <p>
            ‚Ä¢ V·ªõi iOS m·ªõi: t·∫£i b·∫£n m·ªõi nh·∫•t b√¨nh th∆∞·ªùng.<br>
            ‚Ä¢ V·ªõi iOS th·∫•p: n·∫øu nh√† ph√°t tri·ªÉn v·∫´n cho ph√©p t·∫£i b·∫£n c≈© h∆°n, App Store s·∫Ω cho ch·ªçn phi√™n b·∫£n ph√π h·ª£p h∆°n v·ªõi h·ªá ƒëi·ªÅu h√†nh hi·ªán t·∫°i.
        </p>
        <div class="example">
            ƒêi·ªÅu n√†y r·∫•t h·ªØu √≠ch khi b·∫°n mu·ªën gi·ªØ l·∫°i nh·ªØng ·ª©ng d·ª•ng quen thu·ªôc tr√™n iPhone/iPad c≈©, ho·∫∑c kh·ªüi t·∫°o ‚Äúl·ªãch s·ª≠ mua‚Äù cho Apple ID m·ªõi ƒë·ªÉ k·∫øt h·ª£p v·ªõi c√°c c√¥ng c·ª• t·∫£i IPA.
        </div>
    </section>

    <!-- Card l∆∞u √Ω quan tr·ªçng -->
    <section class="card note-card">
        <div class="note-title">
            <span class="icon">üîí</span>
            L∆∞u √Ω quan tr·ªçng
        </div>
        <ul class="note-list">
            <li><span class="num">1.</span>
                <strong>Kh√¥ng l∆∞u t√†i kho·∫£n & m·∫≠t kh·∫©u.</strong>  
                Th√¥ng tin Apple ID ch·ªâ ƒë∆∞·ª£c d√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p qua ipatool ngay t·∫°i th·ªùi ƒëi·ªÉm b·∫°n g·ª≠i y√™u c·∫ßu.  
                H·ªá th·ªëng kh√¥ng thi·∫øt k·∫ø ƒë·ªÉ l∆∞u tr·ªØ ho·∫∑c chia s·∫ª t√†i kho·∫£n c·ªßa b·∫°n.
            </li>
            <li><span class="num">2.</span>
                <strong>Ch·ªâ h·ªó tr·ª£ ·ª©ng d·ª•ng mi·ªÖn ph√≠.</strong>  
                C√¥ng c·ª• n√†y kh√¥ng d√πng ƒë·ªÉ t·∫£i app tr·∫£ ph√≠, crack, hack, cheat hay n·ªôi dung vi ph·∫°m b·∫£n quy·ªÅn.  
                B·∫°n v·∫´n ph·∫£i tu√¢n th·ªß ƒë·∫ßy ƒë·ªß ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng c·ªßa Apple v√† nh√† ph√°t tri·ªÉn.
            </li>
            <li><span class="num">3.</span>
                <strong>K·∫øt qu·∫£ ph·ª• thu·ªôc v√†o Apple & nh√† ph√°t tri·ªÉn.</strong>  
                Vi·ªác c√≥ t·∫£i ƒë∆∞·ª£c b·∫£n c≈© hay kh√¥ng c√≤n t√πy thu·ªôc v√†o vi·ªác app ƒë√≥ c√≤n duy tr√¨ phi√™n b·∫£n t∆∞∆°ng th√≠ch iOS th·∫•p v√† ch√≠nh s√°ch c·ªßa Apple t·∫°i th·ªùi ƒëi·ªÉm b·∫°n s·ª≠ d·ª•ng.
            </li>
        </ul>
    </section>
</div>

<script>
    // Helper ch·ªçn ph·∫ßn t·ª≠
    const $ = (sel) => document.querySelector(sel);

    const form = $("#purchaseForm");
    const loadingEl = $("#loading");
    const errorBox = $("#errorBox");
    const resultCard = $("#resultCard");
    const appInfo = $("#appInfo");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Reset tr·∫°ng th√°i
        errorBox.style.display = "none";
        errorBox.textContent = "";
        resultCard.style.display = "none";
        appInfo.innerHTML = "";

        loadingEl.style.display = "block";

        const body = {
            APPLE_ID: $("#APPLE_ID").value.trim(),
            PASSWORD: $("#PASSWORD").value.trim(),
            CODE: $("#CODE").value.trim(),
            input: $("#INPUT").value.trim()
        };

        try {
            const res = await fetch("/purchase", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            const data = await res.json();
            loadingEl.style.display = "none";

            if (!data || !data.success) {
                errorBox.textContent = (data && data.error) || "Kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i.";
                errorBox.style.display = "block";
                return;
            }

            const app = data.app || {};
            const icon = app.icon || "https://via.placeholder.com/120?text=App";

            appInfo.innerHTML = `
                <img src="${icon}" alt="App Icon">
                <div class="app-meta-main">
                    <div class="app-title">${app.name || "Kh√¥ng r√µ t√™n ·ª©ng d·ª•ng"}</div>
                    <div>Bundle ID: <strong>${app.bundleId || "Kh√¥ng r√µ"}</strong></div>
                    <div>Phi√™n b·∫£n: <strong>${app.version || "Kh√¥ng r√µ"}</strong></div>
                    <div>Nh√† ph√°t h√†nh: <strong>${app.artistName || "Kh√¥ng r√µ"}</strong></div>
                </div>
            `;

            resultCard.style.display = "block";
        } catch (err) {
            loadingEl.style.display = "none";
            errorBox.textContent = err.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh.";
            errorBox.style.display = "block";
        }
    });
</script>

</body>
</html>